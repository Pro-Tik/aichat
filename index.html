<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Grok Pro Mobile</title>
    <script src="https://js.puter.com/v2/"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">

    <style>
        :root {
            --bg-app: #f0f2f5;
            --bg-chat: #ffffff;
            --bg-header: #ffffff;
            --border-color: #e5e7eb;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --msg-user-bg: #2563eb;
            --msg-user-text: #ffffff;
            --msg-bot-bg: #f3f4f6;
            --msg-bot-text: #111827;
            --input-bg: #f9fafb;
            --accent-color: #2563eb;
            --accent-hover: #1d4ed8;
            --code-bg: #1e1e1e;
        }

        [data-theme="dark"] {
            --bg-app: #000000;
            --bg-chat: #121212;
            --bg-header: #121212;
            --border-color: #333;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --msg-user-bg: #3b82f6;
            --msg-user-text: #ffffff;
            --msg-bot-bg: #2d2d2d;
            --msg-bot-text: #f9fafb;
            --input-bg: #1e1e1e;
            --accent-color: #3b82f6;
            --accent-hover: #60a5fa;
            --code-bg: #0d0d0d;
        }

        /* RESET & BASE */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-app);
            color: var(--text-primary);
            overflow: hidden; /* Prevent body scroll, handle inside app-container */
        }

        /* MAIN CONTAINER */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            background-color: var(--bg-chat);
            position: relative;
        }

        /* --- DESKTOP TWEAKS (Only applied if screen is huge) --- */
        @media (min-width: 769px) {
            body {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }
            .app-container {
                max-width: 900px;
                height: 85vh;
                border-radius: 16px;
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
                border: 1px solid var(--border-color);
            }
        }

        /* HEADER */
        .chat-header {
            flex-shrink: 0;
            height: 60px;
            padding: 0 16px;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-header);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .header-title {
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .model-select {
            padding: 6px 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text-primary);
            font-size: 0.85rem;
            max-width: 110px; /* Prevent wide selects on mobile */
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* CHAT AREA */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        .message-wrapper {
            display: flex;
            gap: 10px;
            max-width: 90%; /* Wider on mobile */
        }
        
        .message-wrapper.user { 
            align-self: flex-end; 
            flex-direction: row-reverse; 
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .user .avatar { background: var(--accent-color); color: #fff; }

        .message-bubble {
            padding: 10px 14px;
            border-radius: 16px;
            font-size: 0.95rem;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .user .message-bubble {
            background: var(--msg-user-bg);
            color: var(--msg-user-text);
            border-bottom-right-radius: 4px;
        }
        .assistant .message-bubble {
            background: var(--msg-bot-bg);
            color: var(--msg-bot-text);
            border-bottom-left-radius: 4px;
        }

        /* MARKDOWN STYLES */
        .message-bubble pre { 
            margin: 8px 0; 
            overflow-x: auto; 
            border-radius: 6px; 
            max-width: 100%;
        }
        .message-bubble code { font-family: 'JetBrains Mono', monospace; font-size: 0.85em; }
        .message-bubble p { margin: 0 0 8px 0; }
        .message-bubble p:last-child { margin: 0; }

        /* INPUT AREA */
        .input-area {
            flex-shrink: 0;
            padding: 10px 16px;
            background: var(--bg-header);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: flex-end;
            gap: 10px;
            /* Handle iPhone bottom safe area */
            padding-bottom: max(10px, env(safe-area-inset-bottom));
        }

        .input-container {
            flex: 1;
            position: relative;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            display: flex;
            align-items: center;
        }

        textarea {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--text-primary);
            padding: 12px 40px 12px 16px;
            font-family: inherit;
            /* 16px font size prevents iOS zoom on focus */
            font-size: 16px; 
            resize: none;
            outline: none;
            max-height: 120px;
            min-height: 24px;
            line-height: 1.4;
        }

        .send-btn {
            position: absolute;
            right: 4px;
            bottom: 4px; /* Sticks to bottom corner */
            width: 36px;
            height: 36px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .send-btn:disabled { opacity: 0.5; }

        /* CODE BLOCKS */
        .code-block-wrapper {
            margin: 10px 0;
            border-radius: 6px;
            overflow: hidden;
            width: 100%;
        }
        .code-header {
            background: #2d2d2d;
            color: #aaa;
            padding: 6px 10px;
            font-size: 0.75rem;
            display: flex;
            justify-content: space-between;
        }
        .copy-btn {
            background: transparent; border: 1px solid #555; color: #ccc;
            border-radius: 4px; font-size: 0.7rem; padding: 2px 8px;
        }
        
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="chat-header">
        <div class="header-title">
            <svg style="width:20px;height:20px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            <span>Grok</span>
        </div>
        <div class="header-controls">
            <select id="model-select" class="model-select">
                <option value="x-ai/grok-4.1-fast" selected>Grok 4.1</option>
                <option value="x-ai/grok-2-1212">Grok 2</option>
            </select>
            <button id="theme-toggle" class="icon-btn">
                <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                <svg id="sun-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line></svg>
            </button>
            <button id="clear-chat" class="icon-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
            </button>
        </div>
    </div>

    <div class="chat-messages" id="chat-messages"></div>

    <div class="input-area">
        <div class="input-container">
            <textarea id="user-input" placeholder="Message..." rows="1"></textarea>
            <button id="send-btn" class="send-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

<script>
    // --- Logic ---
    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const themeToggleBtn = document.getElementById('theme-toggle');
    const clearChatBtn = document.getElementById('clear-chat');
    
    let history = JSON.parse(localStorage.getItem('grok_chat_history')) || [];
    
    // Markdown Setup
    marked.setOptions({
        breaks: true,
        highlight: function(code, lang) {
            const language = highlight.getLanguage(lang) ? lang : 'plaintext';
            return highlight.highlight(code, { language }).value;
        }
    });

    // Theme Logic
    function setTheme(t) {
        document.documentElement.setAttribute('data-theme', t);
        localStorage.setItem('grok_theme', t);
        document.getElementById('sun-icon').classList.toggle('hidden', t !== 'dark');
        document.getElementById('moon-icon').classList.toggle('hidden', t === 'dark');
    }
    const savedTheme = localStorage.getItem('grok_theme') || 'light';
    setTheme(savedTheme);

    themeToggleBtn.onclick = () => {
        const current = document.documentElement.getAttribute('data-theme');
        setTheme(current === 'dark' ? 'light' : 'dark');
    };

    // Render Message
    function renderMsg(role, text) {
        const div = document.createElement('div');
        div.className = `message-wrapper ${role}`;
        
        // Avatar
        const av = document.createElement('div');
        av.className = 'avatar';
        av.innerHTML = role === 'user' ? 'U' : 'G';
        
        // Bubble
        const bub = document.createElement('div');
        bub.className = 'message-bubble';
        
        if(role === 'assistant') {
            bub.innerHTML = marked.parse(text);
        } else {
            bub.textContent = text;
        }

        div.append(av, bub);
        chatMessages.append(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Load History
    history.forEach(msg => renderMsg(msg.role, msg.content));

    // Send Logic
    async function send() {
        const text = userInput.value.trim();
        if(!text) return;

        renderMsg('user', text);
        userInput.value = '';
        userInput.style.height = 'auto'; // Reset height
        
        history.push({role:'user', content:text});
        localStorage.setItem('grok_chat_history', JSON.stringify(history));

        const loadingDiv = document.createElement('div');
        loadingDiv.className = 'message-wrapper assistant';
        loadingDiv.innerHTML = '<div class="avatar">G</div><div class="message-bubble">...</div>';
        chatMessages.append(loadingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        try {
            const model = document.getElementById('model-select').value;
            const resp = await puter.ai.chat(history, { model });
            const reply = resp.message.content;

            loadingDiv.remove();
            renderMsg('assistant', reply);
            
            history.push({role:'assistant', content:reply});
            localStorage.setItem('grok_chat_history', JSON.stringify(history));
        } catch(e) {
            loadingDiv.remove();
            renderMsg('assistant', 'Error: ' + e.message);
        }
    }

    sendBtn.onclick = send;
    userInput.onkeydown = (e) => {
        if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }
    };

    // Auto-resize Textarea
    userInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
    
    // Clear Chat
    clearChatBtn.onclick = () => {
        if(confirm('Clear history?')) {
            localStorage.removeItem('grok_chat_history');
            history = [];
            chatMessages.innerHTML = '';
        }
    };
</script>
</body>
</html>
